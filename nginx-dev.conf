# Nginx 开发环境配置
# 适用于：前端使用 Vite 开发服务器，后端通过 Nginx 代理
# 访问地址：http://localhost（统一入口）

server {
    listen 80;
    server_name localhost;

    # 字符编码
    charset utf-8;

    # 前端开发服务器代理（Vite 开发服务器）
    # 所有非 /api 的请求都转发到 Vite
    location / {
        proxy_pass http://localhost:3000;
        
        # WebSocket 支持（Vite HMR 热更新需要）
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # 代理请求头设置
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 超时设置（Vite 编译可能需要较长时间）
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # 禁用缓冲（开发环境需要实时响应）
        proxy_buffering off;
    }

    # 后端 API 代理
    # 所有 /api 请求转发到 Spring Boot 后端
    location /api {
        proxy_pass http://localhost:8080;
        
        # 代理请求头设置
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 超时设置
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # 禁用缓冲
        proxy_buffering off;
    }

    # 错误日志
    error_log logs/nginx-dev-error.log;
    access_log logs/nginx-dev-access.log;
}

